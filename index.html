
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="Originally submitted at REIMetolius Porta-Cord™ rope bag can also be used as a lightweight pack or a rope bucket during long multipitch routes and &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://peteonrails.github.com/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:peteonrails.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/08/02/my-review-of-metolius-porta-cord-rope-bag/">My Review of Metolius Porta-Cord Rope Bag</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-02T00:00:00-04:00" pubdate data-updated="true">Aug 2<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="hreview"><div class="item"><p><a href="http://www.rei.com/mp/rc/product/767279">Originally submitted at REI</a></p><div><img src="http://images.powerreviews.com/images_products/09/41/1700774_100.jpg" class="photo" align="left" style="margin: 0 0.5em 0 0"><p style="margin-top:0">Metolius Porta-Cord™ rope bag can also be used as a lightweight pack or a rope bucket during long multipitch routes and big-wall climbs.</p></div><a href="http://www.rei.com/mp/rc/product/767279" style="display: none;" class="url fn"><span class="fn">Metolius Porta-Cord Rope Bag</span></a></div><br clear="left"><p><strong class="summary">Better than a rope bag. Not a crag pack.</strong></p><div>By <strong>Pete Jackson</strong> from <strong>Rumney, NH</strong> on <strong><abbr title="201182T1200-0800" class="dtreviewed" style="border: none; text-decoration: none;">8/2/2011</abbr></strong></div><p><div style="margin: 0.5em 0; height: 15px; width: 83px; background-image: url(http://images.powerreviews.com/images/stars_small.gif); background-position: 0px -108px;" class="prStars prStarsSmall">&nbsp;</div></p><div style="display: none"><span class="rating">3</span>out of 5</div><p><strong>Pros: </strong>Wear Resistant</p><p><strong>Cons: </strong>Small Compartments</p><p><strong>Best Uses: </strong>Sport Climbing, Cragging</p><p><strong>Describe Yourself: </strong>Avid Climber</p><p><strong>Was this a gift?: </strong>No</p><p style="margin-top:1em" class="description">I really wanted to love this pack. To that end, I used it for a full season before returning it to try a better pack. <br xmlns:pr="xalan://com.pufferfish.core.beans.xmlbuilders.xsl.Functions"><br>This pack is, hands-down, better than any rope bag available. If you&#8217;re replacing a rope bag, or avoiding buying one, this is a great way to go. <br><br>That said, it&#8217;s a pretty bad pack. I found the straps uncomfortable, the lid hard to close when overstuffed, and the side pockets useless for holding anything when carrying a rope longer than 50M. <br><br>Unless you&#8217;re carrying a super-skinny rope or a 50M sub-10mm rope, you&#8217;re going to have trouble closing the pack, taking other gear with you, getting anything into those side pockets, and difficulty getting the load to ride correctly. <br><br>Also, I find those gear lashing daisy chains overrated. If you clip your shoes, harness, helmet, or water bottle to the outside of this pack, you&#8217;ll suffer from an unstable load that snags on trail obstacles. Not ideal. <br><br>I live in Rumney NH, exactly 3/4 mile from the crags, and I&#8217;d avoid taking this pack to the cliffs. Instead, I found myself favoring my hiking pack: so I knew something was wrong. <br><br>If you have short approaches, a short rope, not a lot of personal gear, and don&#8217;t mind the minimal padding on the straps, then this is an excellent pack. <br><br>If you are looking for a rope bag and can have your partner carry the rack, food, and water, then this is the pack for you. <br><br>Otherwise, it may not be.</p><p style="margin-top:0.5em">(<a href="http://www.powerreviews.com/legal/terms_of_use.html" rel="license">legalese</a>)</p></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/07/09/intro-to-spatial-programming/">Intro to Spatial Programming</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-07-09T00:00:00-04:00" pubdate data-updated="true">Jul 9<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content">My slides from the presentation &#8220;Intro to Spatial Programming&#8221; are now available. You can download them as:
<ul>
	<li>A 20MB <a href="http://blog.peteonrails.com/wp-content/uploads/2010/07/Intro%20to%20Spatial%20Programming.key">Keynote &#8216;o9 file</a></li>
	<li>A 10MB <a href="http://blog.peteonrails.com/wp-content/uploads/2010/07/Intro%20to%20Spatial%20Programming.pdf">PDF file</a> (transitions and animations will not work)</li>
	<li>A 52MB <a href="http://blog.peteonrails.com/wp-content/uploads/2010/07/Intro%20to%20Spatial%20Programming%20-%20Full.mov">Quicktime Movie ar 1024x768 </a></li>
	<li>A 9.1MB <a href="http://blog.peteonrails.com/wp-content/uploads/2010/07/Intro%20to%20Spatial%20Programming.mov">Quicktime Movie formatted for the iPod and iPad </a>(640x480)</li>
</ul>
I hope you enjoy the slides. If you missed my talk and want me to present the material at your Ruby User Group, contact me.

All presentation material is Copyright 2010 Peter Jackson, licensed under CC 3.0 Attribution. You can reused, redistribute, and remix the content. Just make sure you attribute it with a link.

Enjoy!
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/05/25/the-revenge-of-inigo-montoya/">The Revenge of Inigo Montoya</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-05-25T00:00:00-04:00" pubdate data-updated="true">May 25<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><pre lang='ruby'>
:false
</pre>

You keep using that symbol. I do not think it means what you think it means. 

Today, I&#8217;d like to describe something I like to call: <strong>The Inigo Montoya Attack</strong>. It is the implementation in code &#8211; often with good intentions, but sometimes simply because of ignorance &#8211; of an algorithm which masks one clear, well-known paradigm inside of another that completely obfuscates your actual intent.  Unless you have six-fingers on your right hand (I&#8217;m talking to YOU, <a href="http://en.wikipedia.org/wiki/Count_Rugen">Count Rugen</a>) you are forbidden from this practice. 

Here&#8217;s some code I came across in a codebase I was maintaining. 

<pre lang='ruby'>
 def logged_in_from_token?
    current_user = token_exists? ? log_in_from_token : :false
 end
</pre>

It looks strange. It OUGHT to look strange. What is that :false symbol all about? 

I&#8217;ll tell you what it is. It&#8217;s a very misleading piece of code. Because when you do not log the user in from a token, current_user is NOT set to false, in the boolean sense. It is, in fact, a boolean &#8220;true&#8221; value in Ruby. 

Try this in IRB: 

<pre lang='ruby'>
 if :false  
   puts "You keep using that word. I do not think it means what you think it means." 
else 
  puts "Have fun storming the castle!"
end
</pre>

If <em><strong>:false</strong></em> evaluated to a <em>boolean false</em> value, then you&#8217;d see &#8220;Have fun storming the castle!&#8221;. But instead, you get &#8220;You keep using that word. I do not think it means what you think it means.&#8221; If you&#8217;re trying to make readable code, using the symbol <em><strong>:false</strong></em> is dangerous and misleading. 

To make matters worse, this code assigns <em><strong>:false</strong></em> to the value <strong>current_user</strong>, which is a well-known and established name used in a number of Rails patterns. RESTFul Authentication and Authlogic BOTH support the notion of <strong>current_user</strong>, and when nobody is logged in, THAT METHOD RETURNS FALSE. Not the doppleganger wannabe <em><strong>:false</strong></em>, but a real, honest to goodness, <em>boolean false</em>. (OK: it&#8217;s actually returning nil, but nil is false). 

So imagine my bewilderment when this basic test no longer worked: 

<pre lang='ruby'>
  <%- if current_user %>
    <%= display_logged_in_stuff()  %>
  <% else %>
      You are not logged in
   <% end %>
</pre>

So a couple hours of debugging later, I found myself using &#8216;ack in project&#8217; to remove all references to the silly symbol <em><strong>:false</strong></em>. 

Lessons for Rubyists: 
<ol>
	<li>Be clear. :false is never actually false. Don&#8217;t use it. </li>
	<li>Follow established conventions. The method <strong>some_test?</strong> should always return a boolean value. If it doesn&#8217;t, leave off the question mark!</li>
 	<li>Don&#8217;t reinvent the wheel! The implementor of the code above could have simply used RESTful Authentication or Authlogic and have avoided the whole mess. </li>
	<li>Unit tests are still important! Remember that someone has to maintain your stuff someday. A simple unit test would have caught the bug introduced by using the symbol <strong>:false</strong> in place of a <em><strong>boolean false</strong></em>.</li>
</ol>

Have fun storming the castle!



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/04/14/oracle-spatial-support-in-spatial_adapter-for-activerecord/">Oracle Spatial Support in Spatial_adapter for ActiveRecord</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-04-14T00:00:00-04:00" pubdate data-updated="true">Apr 14<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content">I&#8217;ve recently made public the first cut of functionality for Oracle Spatial support in Fragility&#8217;s <a href="http://github.com/peteonrails/spatial_adapter" target="_blank">Spatial Adapter for ActiveRecord</a>. It&#8217;s not ready for prime time, but it&#8217;s useful enough to open up to collaboration. As soon as I finish up complete spec tests and a couple of refactorings, I plan to issue a pull request and get the functionality included in the main fork of spatial_adapter on Github.

I won&#8217;t go too far into how to use the adapter until it&#8217;s ready for prime time. This message is intended to encourage collaboration among anyone else who is in the unfortunate boat of having to use Oracle Spatial and Rails without built in driver support (which is not fun).

To use the functionality, <a href="http://blog.rayapps.com/2009/09/14/how-to-install-oracle-database-10g-on-mac-os-x-snow-leopard/">install Oracle</a>, <a href="http://rubyforge.org/projects/georuby/">Install GeoRuby </a>, then install <a href="http://github.com/peteonrails/spatial_adapter">my fork of the spatial_adapter</a>.

Then you can do this:

<pre lang="ruby">
   create_table :points_of_interest do |t|
      t.geometry :location
      t.string :venue_name 
      t.timestamps
   end
 
   add_index :points_of_interest, [:location], :spatial => true

</pre>

Then all of the relevant rows will be set up for you in SDO_GEOM_METADATA, SDO_INDEX_METADATA, and SDO_INDEX_METADATA_TABLE. 

Currently, there is only support for geometry types. Explicit point, polygon, line, and multipolygon types will come later. 

Feedback is encouraged.

<em>P.S. To everyone wondering what happened to the VoteFu major upgrade, it&#8217;s imminent. Thanks to everyone who has submitted patches in the past few months. It&#8217;ll be released *real soon now*</em>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/03/26/goodbye-textmate/">Goodbye TextMate</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-03-26T00:00:00-04:00" pubdate data-updated="true">Mar 26<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content">I&#8217;ve been using TextMate to develop Ruby on Rails applications for a very long time. But as of today, I&#8217;m abandoning TextMate. And <a href="http://pivotallabs.com/users/alex/blog/articles/1201-textmate-the-last-straw">I&#8217;m not the only one.</a>

For me, the last straw with TextMate was the issue illustrated<a href="http://blog.peteonrails.com/wp-content/uploads/2010/03/iShowU-Capture2.mov"> in this video</a>. When you have all of your methods folded up, and you delete a line of whitespace that follows a folded up block of code, the editor will in fact delete the entire folded up code block. This might be working as expected, but I expect better.

Some other annoyances I&#8217;ve had with TextMate include:
<ul>
	<li>Random Pinwheeling (lockups that take unspecified amounts of time to clear)</li>
	<li>Sluggish performance</li>
	<li>Drawer behavior: When I want it on the left, I want it on the left. Even if my window is too close to the left side of my monitor. STOP OPENING ON THE RIGHT! DO YOU HEAR ME! (excerpt from an actual conversation with TextMate).</li>
	<li>No significant updates in over two years. Not even the kind you pay for.  I guess the upside of this is that any Bundles you find are pretty well guaranteed to work with your version of TextMate, because there&#8217;s really only one version.</li>
</ul>
After making the decision that I couldn&#8217;t continue to work in a professional setting with an editor that contains so many productivity-sapping limitations for me, I decided to switch.

I found that in making my list of requirements for a replacement editor, the beginning of it was an enumeration of what sucks about TextMate. I needed:
<ol>
	<li> Fast Search in Project</li>
	<li> Fast &#8220;Find Usages&#8221;</li>
	<li> A lack of code-munching bugs.</li>
</ol>
But  there are a lot of things that I like about TextMate. I wanted to keep those features too:
<ol>
	<li>Autosave</li>
	<li>Fuzzy Match</li>
	<li>Strong Ruby Language Support</li>
	<li>HAML and SASS support</li>
	<li>Modules / Plugins / Bundles</li>
	<li>No Crashing</li>
	<li>Themes and control over colorization</li>
</ol>
First, I checked out <a href="http://www.jetbrains.com/ruby/index.html">RubyMine</a>, but found that it crashed and froze on me a lot. I can&#8217;t have a code editor that crashes or freezes a lot. Alex Chaffee of Pivotal Labs likes RubyMate, however, so your mileage may vary. It&#8217;s worth checking out. <a href="http://www.jetbrains.com/ruby/download/index.html">And you can check it out for free</a>.

Next I investigated <a href="http://www.panic.com/coda/">Coda</a>: it&#8217;s pretty, but doesn&#8217;t have a made-for-ruby feel to it. It&#8217;s got a very extensible plugin framework, and a lot of plugins made for it, but a couple of key plugins were missing, and I can&#8217;t afford to take the time to write the plugins right now.

Then I tried BBEdit: nice, but again: not enough support through plugins for the kinds of ruby development I do.

Then MacVim: which is awesome but I HATE &#8216;vi&#8217; (if I&#8217;m going to use a UNIX editor for programming, it&#8217;s going to be emacs).

Finally, I decided to try <a href="http://netbeans.org/">NetBeans</a>, and found everything I needed, and some stuff I didn&#8217;t even KNOW I needed. I was genuinely surprised that I liked NetBeans, given its background as a Java IDE. But the Ruby modules for Netbeans are very nice. Here&#8217;s what I liked the most, in no particular order:
<ul>
	<li>Autotest, running right in the IDE: I don&#8217;t have to remember to start it in a terminal. It just runs in my IDE.</li>
	<li>Search. It&#8217;s Fast. And I didn&#8217;t have to install Ack In Project to make it so.</li>
	<li>When my continuous integration build fails, my IDE is notified, and it tells me so.</li>
	<li>It integrates with bug trackers.</li>
</ul>
Aside from the &#8220;search&#8221; item, I didn&#8217;t even know I needed half of that stuff. But now that I have it, I can&#8217;t go back.

I still use TextMate for a basic editor, and still love the column-wise cut-and-paste feature. But I won&#8217;t use it for development anymore.

So long, TextMate. It&#8217;s been a ride.
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/17/new-rails-plugin-available-yaml-twitter-oauth/">New Rails Plugin Available: YAML Twitter OAuth</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-17T00:00:00-05:00" pubdate data-updated="true">Nov 17<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content">When I build Twitter OAuth apps, I usually register three apps. One for development purposes, one for staging and user-acceptance testing, and the production application. Each of these registered apps will have a different Twitter OAuth Consumer Token and Secret. Instead of writing procedural code to set the right tokens up for each environment, or setting them in the various environment/*.rb files, I prefer to set them up declaratively like you do in database.yml.

I&#8217;ve extracted the basic code i use to do this and published it as a simple plugin called <a title="yaml_twitter_oauth" href="http://github.com/peteonrails/yaml_twitter_oauth">yaml_twitter_oauth</a>.

It allows you to set up your consumer tokens like this:
<pre lang="yaml">defaults: &defaults
  request_token_url: http://twitter.com/oauth/request_token
  access_token_url: http://twitter.com/oauth/access_token
  authorize_url: http://twitter.com/oauth/authorize

development:
  <<: *defaults
  consumer_key: 12345678
  consumer_secret: this-is-your-application-secret

staging:
  <<: *defaults
  consumer_key: 12345678
  consumer_secret: this-is-your-application-secret

production:
  <<: *defaults
  consumer_key: 12345678
  consumer_secret: this-is-your-application-secret
</pre>

It&#8217;s also useful if you want to regenerate your secret key and need a simple declarative way to update it. 

To install the plugin: 

<pre lang="bash">
 script/plugin install git://github.com/peteonrails/yaml_twitter_oauth.git
</pre> 

Enjoy! 
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/14/votefu-is-now-available-on-gemcutter/">VoteFu Is Now Available on GemCutter</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-14T00:00:00-05:00" pubdate data-updated="true">Nov 14<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><img class="alignright size-thumbnail wp-image-195" title="gem" src="http://blog.peteonrails.com/wp-content/uploads/2009/11/gem-150x150.jpg" alt="gem" width="150" height="150" />@alexanderkahn asked me via <a class="zem_slink" title="Twitter" rel="homepage" href="http://twitter.com/">Twitter</a> whether I&#8217;d be pushing VoteFu to GemCutter. To tell you the truth, I hadn&#8217;t really thought about it. But, it does seem to be what all the cool kids are doing.

Want to see how easy it was to move to GemCutter?
<pre lang="bash">ping:$ sudo gem install gemcutter
Password:

========================================================================

           Thanks for installing Gemcutter! You can now run:

    gem tumble        use Gemcutter as your primary RubyGem source
    gem push          publish your gems for the world to use and enjoy
    gem migrate       take over your gem from <a class="zem_slink" title="RubyForge" rel="homepage" href="http://rubyforge.org/">RubyForge</a> on Gemcutter
    gem owner         allow/disallow others to push to your gems

========================================================================

Successfully installed gemcutter-0.1.6
1 gem installed
Installing ri documentation for gemcutter-0.1.6...
Installing RDoc documentation for gemcutter-0.1.6...
ping: Pete$ gem tumble
Thanks for using Gemcutter!
Your gem sources are now:
- http://gemcutter.org
- http://gems.rubyforge.org
- http://gems.github.com
ping:workspace Pete$ cd vote_fu_harness/vendor/plugins/vote_fu/
ping:vote_fu Pete$ ls
CHANGELOG.markdown      README.markdown         examples                init.rb                 rails                   test
MIT-LICENSE             db                      generators              lib                     spec                    vote_fu.gemspec
ping:vote_fu Pete$ gem build vote_fu.gemspec
WARNING:  no rubyforge_project specified
  Successfully built RubyGem
  Name: vote_fu
  Version: 0.0.11
  File: vote_fu-0.0.11.gem
ping:vote_fu Pete$ gem push vote_fu-0.0.11.gem
Enter your Gemcutter credentials. Don't have an account yet? Create one at http://gemcutter.org/sign_up
Email:   pete@peteonrails.com
Password:
Signed in. Your api key has been stored in ~/.gemrc
Pushing gem to Gemcutter...
Successfully registered gem: vote_fu (0.0.11)
ping:vote_fu Pete$</pre>
Scarily easy. In under 3 minutes I have a new primary gem source and am set up to publish to GemCutter.

So, why would one want o host Gems on GemCutter? I asked the same question. In a nutshell:
<ol>
	<li>Download counts are shown inline</li>
	<li>Build locally, then push-to-publish. No more waiting to make your way through DJ, BJ, Resque, or whatever the background framework of the day is at <a class="zem_slink" title="GitHub" rel="homepage" href="http://github.com">GitHub</a>.</li>
	<li>It&#8217;s nothing but gem hosting, so it&#8217;ll probably grow to do gem hosting really well.</li>
	<li>It&#8217;s ThoughtBot. I like the ThoughtBot guys.</li>
</ol>
So, there&#8217;s no real compelling reason to run out and move your gems to GemCutter, but if your users ask you to do it, it takes 3 minutes or less.
<div class="zemanta-pixie" style="margin-top: 10px; height: 15px;"><a class="zemanta-pixie-a" title="Reblog this post [with Zemanta]" href="http://reblog.zemanta.com/zemified/a240f45a-6168-42d3-808c-922211278fb5/"><img class="zemanta-pixie-img" style="border: none; float: right;" src="http://img.zemanta.com/reblog_e.png?x-id=a240f45a-6168-42d3-808c-922211278fb5" alt="Reblog this post [with Zemanta]" /></a><span class="zem-script more-related pretty-attribution"><script src="http://static.zemanta.com/readside/loader.js" type="text/javascript"></script></span></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/11/how-i-became-convinced-to-use-dbpopulate-instead-of-dbmigrate-with-inline-data-seeding-and-why-you-should-too/">How I Became Convinced to Use Db:populate Instead of Db:migrate With Inline Data Seeding, and Why You Should Too.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-11T00:00:00-05:00" pubdate data-updated="true">Nov 11<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><img class="alignright size-thumbnail wp-image-178" title="iStock_000002051165XSmall" src="http://blog.peteonrails.com/wp-content/uploads/2009/11/iStock_000002051165XSmall-150x150.jpg" alt="iStock_000002051165XSmall" width="150" height="150" />There&#8217;s a lot of established debate and best practice around how to populate your database with the initial reference data it needs in order to operate. I&#8217;m not going to rehash that here. If you&#8217;re interested in the options available for seeding data, <a href="http://railspikes.com/2008/2/1/loading-seed-data">read Luke Franci&#8217;s article on Rails Spikes.</a> Many people I work with seem to like &#8220;db:populate&#8221; which, while very nice and flexible, always seemed like a little bit of overkill to me.

I was always in favor of seeding short reference data right in the migration like this:
<pre lang="ruby">class CreateTestScopes < ActiveRecord::Migration
  def self.up
    create_table :test_scopes do |t|
      t.string  :name
      t.timestamps
    end

    %w(first second third).each do |e|
       TestScope.create(:name => e)
     end
  end

  def self.down
    drop_table :test_scopes
  end

end</pre>
JUST TO BE CLEAR: we&#8217;re talking about production reference data that the application requires in order to run. We are not talking about TEST data, which belongs in mocks or (gasp) fixtures. A really good example of legitimate production seed data is the creation of the out-of-box Administrative user.

And if I had to update my reference data, I was also a fan of including it in the migration. After all, it&#8217;s reference data, not test data, fixture data (eww!) or user data.
<pre lang="ruby">class CapitalizeTestScopes < ActiveRecord::Migration
  def self.up
    TestScope.all.each { |t| t.name = t.name.capitalize; t.save! }
  end

  def self.down
    puts "Can't undo, but don't freak out!"
  end
end</pre>
Later, I decided I wanted a sort-order column and decided to add something like this:
<pre lang="ruby">class AddSortOrderToTestScopes < ActiveRecord::Migration
  def self.up
    add_column :test_scopes, :sort_order, :integer
  end
  # omit self.down ....
end

class TestScope &lt; ActiveRecord::Base
  default_scope :order => "sort_order"
end</pre>
And here&#8217;s the crux of the issue:

By adding a column that the model depends on in the default_scope, we&#8217;ve made it a requirement for the sort_order column to be present in order to load and query the model object. That&#8217;s fine for me. This migration will run with no errors on my workstation, provided that I ran db:migrate immediately prior to my latest changeset.

However, if you want to come up to speed on my project, you cannot do this:
<pre lang="bash"> bash# rake db:setup
 bash# rake db:migrate</pre>
Because here&#8217;s what will happen:
<pre lang="bash">==  CapitalizeTestScopes: migrating ===========================================
rake aborted!
An error has occurred, this and all later migrations canceled:

SQLite3::SQLException: no such column: sort_order: SELECT * FROM "test_scopes"  ORDER BY sort_order</pre>
Since we&#8217;re using the ActiveRecord object to do our reference updates (which is A GOOD THING, since we get validations and abbreviated syntax), we can&#8217;t have dependencies in the default scope that are not defined before the first use of the ActiveRecord object in our migrations.

A lot of folks argue that migrations are not reliable and shouldn&#8217;t be the way you&#8217;re creating your schema in the first place. To that, I respectfully say, &#8220;You&#8217;re wrong.&#8221;

It is only because we developers make boneheaded mistakes like the one outlined above that we cannot rely on migrations to rebuild our schema incrementally from migrations. Rather than be boneheaded, we should <strong>be awesome instead</strong> and fix the migration dependencies by moving the data seeding out to a db:populate or other rake task that operates on a completely built data structure. (I know: this is not in line with the movement toward schema.rb as the authoritative source of the database structure. I&#8217;m not up for arguing that point today, but I will argue it.)

The answer is to do this:
<pre lang="ruby"># file: db/migrate/X_create_test_scopes.rb
class CreateTestScopes < ActiveRecord::Migration
  def self.up
    create_table :test_scopes do |t|
      t.string  :name
      t.timestamps
    end
  end

  def self.down
    drop_table :test_scopes
  end
end

# File: db/populate/001_seed_scopes.rb
%w(first second third).each do |e|
   TestScope.create(:name => e)
 end</pre>
Then, when you have to capitalize your model data:
<pre lang="ruby"># File: db/populate/002_capitalize_scopes.rb
TestScope.all.each { |t| t.name = t.name.capitalize; t.save! }</pre>
And then when you add the sort order:
<pre lang="ruby">class AddSortOrderToTestScopes < ActiveRecord::Migration
  def self.up
    add_column :test_scopes, :sort_order, :integer
  end
  # omit self.down ....
end

class TestScope < ActiveRecord::Base
  default_scope :order => "sort_order"
end

# file db/populate/003_seed_sort_order.rb
TestScope.each_with_index { |e, i| e.sort_order = i; e.save! }</pre>
Voila! You can run db:migrate with a fresh database and have no errors.

So far, when I encounter an issue that prevents me from rebuilding my complete schema incrementally using db:migrate, it&#8217;s been a Rails Smell. I haven&#8217;t found a legitimate reason why migrations can&#8217;t be sorted out to build cleanly every time. If you can&#8217;t rebuild your database incrementally using migrations, it&#8217;s likely that you&#8217;re doing something wrong.

I ignored this debate for a long time because it didn&#8217;t really affect me. Don&#8217;t be like me. Save yourself the trouble of unwinding your migration mess and use an outside seeding package like db:populate.
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/04/03/myquotable-source-code-available-again/">MyQuotable Source Code Available Again</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-03T00:00:00-04:00" pubdate data-updated="true">Apr 3<span>rd</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content">I took the MyQuotable example code down from github for a little while because I&#8217;d hosed it up trying to convert it into a facebook application. A few users have emailed me in the past month or so asking where the code is located. 

I&#8217;ve just republished the source code, so you can again download my example application for VoteFu. 


</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/03/16/why-rails-developers-are-at-such-peace-with-the-world/">Why Rails Developers Are at Such Peace With the World.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-03-16T00:00:00-04:00" pubdate data-updated="true">Mar 16<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><img class="aligncenter size-full wp-image-169" title="Girl working with laptop in a flowering field" src="http://blog.peteonrails.com/wp-content/uploads/2009/11/iStock_000004133301XSmall.jpg" alt="Girl working with laptop in a flowering field" width="425" height="282" />

Because they already know the answer to the burning theological question that has ignited fury around the globe for thousands of years.
<pre lang="bash">[pete@me.local log]$ which god
/usr/local/bin/god</pre>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2011/08/02/my-review-of-metolius-porta-cord-rope-bag/">My Review of Metolius Porta-Cord Rope Bag</a>
      </li>
    
      <li class="post">
        <a href="/blog/2010/07/09/intro-to-spatial-programming/">Intro to Spatial Programming</a>
      </li>
    
      <li class="post">
        <a href="/blog/2010/05/25/the-revenge-of-inigo-montoya/">The Revenge of Inigo Montoya</a>
      </li>
    
      <li class="post">
        <a href="/blog/2010/04/14/oracle-spatial-support-in-spatial_adapter-for-activerecord/">Oracle Spatial support in spatial_adapter for ActiveRecord</a>
      </li>
    
      <li class="post">
        <a href="/blog/2010/03/26/goodbye-textmate/">Goodbye TextMate</a>
      </li>
    
  </ul>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
