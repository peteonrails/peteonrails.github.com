---
layout: post
title: ! 'Ruby Gem - Threaded Collections: Process collections over many threads'
tags:
- Code
- Rails
- Ruby
status: publish
type: post
published: true
meta:
  _edit_last: '2'
---
I often have to iterate over a collection and perform some remote, or long running task on each member of the collection.

Threaded Collections is a package for iterating through collections over multiple threads. With large collections, sometimes it can be more efficient to process a collection in parallel, provided that the collected items don't have a interdependencies, or need to be processed in a specific order. 

Usage: 
<pre lang="ruby" line="1">
require "threaded_collections"

threadcount = 2
arr = [1, 2, 3, 4, 5, 6, 7, 8, 9, 0]
tps = ThreadedCollectionProcessor.new(arr)
tps.process(2) do |thread_id, item| 
  puts "Thread #{thread_id} processed item: #{item}" 
  sleep 1
end

</pre>

I abstracted this pattern from a web services client that posted items from a collection, but
each request took a second to process. The remote service had plenty of threads available, so
I parallelized the task with this pattern. 

I have no plans to break the interface but I do plan to make two major enhancements: 

<ol>
<li>Make it possible to mix this functionality in to the Ruby iterators, so you don't have create the ThreadedCollectionProcessor.</li>
<li>Make it work with fibers and processes in addition to threads. </li>
</ol>
 
If you want to check it out, you can get the source from <a href="http://github.com/peteonrails/threadedcollections/tree/master">the threadedcollections github site</a>. 

To install the gem without git:
<pre lang="bash" line="1">
bash# sudo gem install peteonrails-threaded-collections --source=http://gems.github.com
</pre>
