---
layout: post
title: acts-as-taggable-on and space delimited tag lists
tags:
- acts-as-taggable-on plugin rails workaround
- Code
- Rails
status: publish
type: post
published: true
meta:
  _edit_last: '2'
---

<h2> UPDATE: </h2>

I made the classic coder mistake, and didn't dig into the plugin code before working around it. I am leaving this post up instead of being embarrassed and deleting it because it a good example of why you should read your plugin code. After reading the code, I found that <strong>TAGLIST IS JUST AN ARRAY</strong>: you can simply do this and avoid all of the filter magic that I put in place below. 

<pre lang="ruby" line="1">
  # in config/initializers/tag_list.rb
  TagList.delimiter = " "
</pre>

Drat. That's way better. 

As it turns out, this answer is in the README for acts_as_taggable_on_steroids, but not in acts_as_taggable_on. I'm sending Michael a note to ask him to include that detail in the documentation. 

<h2> Original Post </h2>

Michael Bleigh's <a href="http://www.intridea.com/tags/acts_as_taggable_on">acts_as_taggable_on</a> plugin is a useful extension of acts_as_taggable_on_steroids. 

When using it in forms, however, many users have noticed that the @model.tag_list field deals with comma separated lists of tags, like so: 

<pre lang="ruby" line="1">
# From the README
@user.tag_list = "awesome, slick, hefty"      # this should be familiar
</pre>

If, in your edit view template, you provide a text field for your users to type in freeform tags, then you will find that your database tables have multiword tags instead of multiple tags. This is less than ideal. Users do not like to type commas. 

Build your form like this, and you will see the issue when a user types in "awesome slick hefty" in the input box. 

<pre lang="html">
<% form_for([@model]) do |f| %>
    <div id="model_tags">
	Tags: <%= f.text_field :tag_list %> 		
    </div>
...
<% end %>
</pre>

You will see this in your DB: 
<pre lang="bash">
+----+-----------------------------------+
| id | name                              |
+----+-----------------------------------+
|  1 | awesome slick hefty               | 
+----+-----------------------------------+
</pre>

What you <em> wanted </em> was this: 
<pre lang="bash">
+----+-----------------------------------+
| id | name                              |
+----+-----------------------------------+
|  1 | awesome                           | 
|  2 | slick                             | 
|  3 | hefty                             | 
+----+-----------------------------------+
</pre>



<h2> The Answer </h2>
My workaround involves using a before_filter to unroll the content of the input box, and a compactor method in the edit action to change the internal storage format of acts_as_taggable_on to the format that the user expects. Here is an example: 

<pre lang="ruby" line="1">
# ... In the taggable_controller
  before_filter :join_tag_list, :only => [:create, :update]

  # GET /users/:id/quotes/1/edit
  def edit 
    @model ||= Model.find(params[:id])
    unroll_tag_list
  end

  private
  def join_tag_list
    # Split the tags on spaces and join into comma separated format
    params[:model][:tag_list] = params[:model][:tag_list].split(" ").join(",")
  end

  def unroll_tag_list
    # Split the tags on commas and join into a single space separated string
    @model.tag_list = @model.tag_list.join(" ")    
  end
  
</pre>

That's it! Now my users see and work with space-separated tags, and acts_as_taggable_on continues to store comma separated lists internally. 
